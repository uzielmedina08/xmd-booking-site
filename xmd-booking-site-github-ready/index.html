<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Xquisite Mobile Detailing — Book a Wash</title>
<style>
:root { --accent:#0b74de; --bg:#f7f9fc; --card:#ffffff; }
*{box-sizing:border-box}
body{font-family:Inter, system-ui,-apple-system,'Segoe UI',Roboto,'Helvetica Neue',Arial; margin:0; background:var(--bg); color:#0b2540}
.container{max-width:920px;margin:36px auto;padding:20px}
header{display:flex;gap:16px;align-items:center}
.logo{width:64px;height:64px;border-radius:8px;background:linear-gradient(135deg,var(--accent),#3bb78f);display:flex;align-items:center;justify-content:center;color:#fff;font-weight:700;font-size:18px}
h1{margin:0 0 6px;font-size:24px}
p.lead{margin:0 0 18px;color:#274156}
.card{background:var(--card);border-radius:12px;padding:18px;box-shadow:0 6px 20px rgba(15,23,42,0.06)}
form{display:grid;grid-template-columns:1fr 1fr;gap:12px}
label{display:block;font-size:13px;margin-bottom:6px}
input[type=text],input[type=email],input[type=tel],select,textarea,input[type=date]{width:100%;padding:14px;border:1px solid #e3e7ee;border-radius:8px;font-size:16px}
textarea{resize:vertical;min-height:100px}
.full{grid-column:1 / -1}
.actions{display:flex;gap:8px;align-items:center;justify-content:space-between;margin-top:12px}
button{background:var(--accent);color:#fff;border:0;padding:14px 18px;border-radius:10px;font-weight:600;cursor:pointer;font-size:16px}
.note{font-size:13px;color:#4b5563}
#pricing h2{text-align:center;font-size:1.8em;margin-bottom:20px}
#pricing h3{margin-top:20px;margin-bottom:10px}
#pricing ul{list-style:none;padding-left:0}
#pricing li{margin-bottom:6px}
#pricing p{font-style:italic;color:#666;margin-top:10px}
@media (max-width:700px){
  form{grid-template-columns:1fr}
  .logo{width:56px;height:56px}
  h1{font-size:20px}
  p.lead{font-size:14px}
  button{width:100%;margin-top:8px}
  .actions{flex-direction:column;align-items:stretch}
}
.badge{display:inline-block;background:#eef2ff;color:#1f3a8a;padding:4px 8px;border-radius:999px;font-size:12px;margin-left:8px}
.hidden{display:none}
</style>
</head>
<body>
<div class="container">
  <header>
    <div class="logo">XD</div>
    <div>
      <h1>Xquisite Mobile Detailing <span class="badge">Mobile-friendly</span></h1>
      <p class="lead">Fast, convenient mobile car washes — we come to you. Choose a date & one of the available times below.</p>
    </div>
  </header>

  <div class="card">
    <!-- No action attribute — we handle submission with JavaScript to the Netlify Function -->
    <form id="bookingForm" novalidate>
      <div>
        <label for="name">Full Name</label>
        <input id="name" name="name" type="text" required>
      </div>
      <div>
        <label for="email">Email Address</label>
        <input id="email" name="email" type="email" required>
      </div>
      <div>
        <label for="phone">Phone Number</label>
        <input id="phone" name="phone" type="tel" required>
      </div>

      <div>
        <label for="service">Service</label>
        <select id="service" name="service" required>
          <option value="">Select a service</option>
          <option>Basic Wash</option>
          <option>Full Detail</option>
        </select>
      </div>

      <div>
        <label for="date">Date</label>
        <input id="date" name="date" type="date" required>
      </div>

      <div>
        <label for="time">Time</label>
        <select id="time" name="time" required>
          <option value="">Select a time</option>
          <option value="08:00">8:00 AM</option>
          <option value="10:00">10:00 AM</option>
          <option value="12:00">12:00 PM</option>
          <option value="14:00">2:00 PM</option>
          <option value="16:00">4:00 PM</option>
          <option value="18:00">6:00 PM</option>
          <option value="20:00">8:00 PM</option>
        </select>
      </div>

      <div class="full">
        <label for="notes">Additional Notes</label>
        <textarea id="notes" name="notes" placeholder="Address, access details, special requests..."></textarea>
      </div>

      <div class="full actions">
        <button id="submitBtn" type="submit">Request Appointment</button>
        <p class="note">We’ll confirm by phone or email. Times update live as slots are booked.</p>
      </div>

      <div id="msg" class="full hidden" aria-live="polite"></div>
    </form>
<p id="error-message" style="color:red;"></p>
  </div>

  <section id="pricing" class="card" style="margin-top: 30px;">
    <h2>Price List</h2>
    <h3>Wash and Dry Only (includes inside vacuumed)</h3>
    <ul>
      <li><strong>Car:</strong> $20</li>
      <li><strong>Mid Sized SUV:</strong> $30</li>
      <li><strong>Truck and Full Sized SUV:</strong> $45</li>
    </ul>

    <h3>Wash/Dry and Detail Inside/Out</h3>
    <ul>
      <li><strong>Car:</strong> $40</li>
      <li><strong>Mid Sized SUV:</strong> $60</li>
      <li><strong>Truck and Full Sized SUV:</strong> $90</li>
    </ul>

    <p>Note: These prices may vary depending on how dirty the vehicle is. This is just the base price.</p>
  </section>
</div>





<script>
document.addEventListener("DOMContentLoaded", () => {
  const dateInput = document.getElementById("date");
  const timeSelect = document.getElementById("time");
  const bookingForm = document.getElementById("bookingForm");

  async function fetchBookedTimes(date) {
    const res = await fetch(`/.netlify/functions/getBookings?date=${date}`);
    if (!res.ok) return [];
    return await res.json();
  }

  function generateTimeSlots() {
    const slots = [];
    for (let hour = 8; hour <= 20; hour++) {
      const h = String(hour).padStart(2, "0");
      slots.push(`${h}:00`);
    }
    return slots;
  }

  function formatAMPM(time24) {
    const [hourStr, minute] = time24.split(":");
    let hour = parseInt(hourStr, 10);
    const ampm = hour >= 12 ? "PM" : "AM";
    hour = hour % 12;
    if (hour === 0) hour = 12;
    return `${hour}:${minute} ${ampm}`;
  }

  async function updateAvailableTimes() {
    const date = dateInput.value;
    if (!date) return;

    const bookedTimes = await fetchBookedTimes(date);
    const allSlots = generateTimeSlots();

    const availableSlots = allSlots.filter(slot => {
      const slotTime = new Date(`1970-01-01T${slot}:00`);
      return !bookedTimes.some(booked => {
        const bookedTime = new Date(`1970-01-01T${booked}:00`);
        const diff = Math.abs(slotTime - bookedTime);
        return diff < 2 * 60 * 60 * 1000; // 2-hour gap
      });
    });

    timeSelect.innerHTML = "";
    availableSlots.forEach(slot => {
      const option = document.createElement("option");
      option.value = slot; // backend gets 24-hour format
      option.textContent = formatAMPM(slot); // display AM/PM
      timeSelect.appendChild(option);
    });
  }

  dateInput.addEventListener("change", updateAvailableTimes);

  bookingForm.addEventListener("submit", async (e) => {
    e.preventDefault();
    const formData = new FormData(bookingForm);
    const booking = Object.fromEntries(formData.entries());

    const res = await fetch("/.netlify/functions/addBooking", {
      method: "POST",
      body: JSON.stringify(booking)
    });

    const msg = await res.text();
    if (res.ok) {
      window.location.href = "thankyou.html";
    } else {
      document.getElementById('error-message').innerText = msg;
    }
  });
});
</script>




</body>
</html>
